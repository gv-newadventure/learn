Awesome, thanks for the photos — that’s enough to wire up a real test-data loader that respects all the FKs:

Tables involved:

tbl_IMG_Documents (PK: DocumentID identity)

tbl_IMG_DocumentDetails (PK DocDetID identity, FK → Documents.DocumentID)

tbl_IMG_DocumentKeys (PK DocumentKey GUID, FK → DocumentDetails.DocDetID)

tbl_IMG_DocumentData (PK/FK DocumentKey → DocumentKeys.DocumentKey, FieldData xml NOT NULL)


We’ll create one C# console app that:

1. For each synthetic document:

Inserts into tbl_IMG_Documents

Inserts into tbl_IMG_DocumentDetails

Inserts into tbl_IMG_DocumentKeys

Inserts into tbl_IMG_DocumentData



2. Uses SCOPE_IDENTITY() to capture DocumentID and DocDetID


3. Generates realistic FieldData XML (with some <FieldData /> rows to test that case)


4. Lets you choose how many records to create (e.g. 1,000,000)



This is row-by-row (simpler and respects identity FKs); if you later want a SqlBulkCopy optimization, we can layer that on.


---

1️⃣ appsettings.json

In your console project root:

{
  "ConnectionStrings": {
    "RemapDb": "Server=YOUR_SERVER;Database=DFXR2;Trusted_Connection=True;Encrypt=False"
  },
  "TestData": {
    "TotalRecords": 1000000,
    "SiteCode": "R2"
  }
}

Adjust server/db as needed.


---

2️⃣ Program.cs

This is a complete, compile-ready .NET 8 console that does the inserts.

using System;
using System.Data;
using System.Text;
using System.Threading.Tasks;
using Microsoft.Data.SqlClient;
using Microsoft.Extensions.Configuration;

namespace Remap.TestDataLoader
{
    internal class Program
    {
        static async Task Main(string[] args)
        {
            // 1. Load configuration
            var config = new ConfigurationBuilder()
                .AddJsonFile("appsettings.json", optional: false)
                .AddEnvironmentVariables()
                .Build();

            var connString = config.GetConnectionString("RemapDb")
                             ?? throw new InvalidOperationException("Missing connection string 'RemapDb'.");

            int totalRecords = config.GetSection("TestData").GetValue("TotalRecords", 1_000_000);
            string siteCode = config.GetSection("TestData").GetValue("SiteCode", "R2");

            Console.WriteLine($"Connection : {connString}");
            Console.WriteLine($"Total rows : {totalRecords}");
            Console.WriteLine($"SiteCode   : {siteCode}");
            Console.WriteLine();

            var loader = new TestDataLoader(connString, siteCode);

            var start = DateTime.UtcNow;

            for (int i = 0; i < totalRecords; i++)
            {
                if (i % 1000 == 0 && i > 0)
                {
                    var elapsed = DateTime.UtcNow - start;
                    Console.WriteLine(
                        $"[{DateTime.Now:T}] Inserted {i}/{totalRecords} rows (elapsed {elapsed.TotalSeconds:F1}s)");
                }

                await loader.InsertOneDocumentAsync(i);
            }

            var totalElapsed = DateTime.UtcNow - start;
            Console.WriteLine($"DONE. Inserted {totalRecords} rows in {totalElapsed.TotalMinutes:F1} minutes.");
        }
    }

    internal sealed class TestDataLoader
    {
        private readonly string _connectionString;
        private readonly string _siteCode;
        private readonly Random _random = new();

        // constants from your screenshots – safe to reuse for test data
        private static readonly Guid DocClientKey     = Guid.Parse("31C18D6A-0ABE-4FAF-A9AC-3472F05515BF");
        private static readonly Guid CategoryKey      = Guid.Parse("1CDB0953-4D94-4687-98E0-45750D1D51F2");
        private static readonly Guid ChangeUserKey    = Guid.Parse("C59A0230-F96E-4B92-9746-A098F313C3A5");
        private static readonly Guid UploadUserKey    = Guid.Parse("5EC6F8E8-A587-4AC3-9C72-FDE52EDBBFBE");
        private static readonly Guid DocStoreFileId   = Guid.Parse("7D5B0942-F506-4540-B568-5EE864E6DDF9");

        public TestDataLoader(string connectionString, string siteCode)
        {
            _connectionString = connectionString;
            _siteCode = siteCode;
        }

        /// <summary>
        /// Inserts one synthetic document into all four tables:
        /// tbl_IMG_Documents → tbl_IMG_DocumentDetails → tbl_IMG_DocumentKeys → tbl_IMG_DocumentData.
        /// </summary>
        public async Task InsertOneDocumentAsync(int index)
        {
            using var conn = new SqlConnection(_connectionString);
            await conn.OpenAsync();

            using var cmd = conn.CreateCommand();
            cmd.CommandType = CommandType.Text;

            // single round-trip: all inserts and identity captures
            cmd.CommandText = @"
DECLARE @Now datetime = GETDATE();
DECLARE @DocumentID bigint;
DECLARE @DocDetID bigint;
DECLARE @DocumentKey uniqueidentifier = NEWID();

-- 1) Insert into tbl_IMG_Documents
INSERT INTO dbo.tbl_IMG_Documents
(
    DocType,
    UploadDate,
    UploadUserKey,
    UploadSource,
    DocStoreFileID,
    DocumentContents,
    HasScriptsRemoved
)
VALUES
(
    @DocType,
    @UploadDate,
    @UploadUserKey,
    @UploadSource,
    @DocStoreFileID,
    NULL,
    NULL
);

SET @DocumentID = SCOPE_IDENTITY();

-- 2) Insert into tbl_IMG_DocumentDetails
INSERT INTO dbo.tbl_IMG_DocumentDetails (DocumentID)
VALUES (@DocumentID);

SET @DocDetID = SCOPE_IDENTITY();

-- 3) Insert into tbl_IMG_DocumentKeys
INSERT INTO dbo.tbl_IMG_DocumentKeys
(
    DocumentKey,
    SiteCode,
    DocClientKey,
    Deleted,
    DocStatus,
    CategoryKey,
    SubcategoryID,
    DocDesc,
    DocPriority,
    DocPriorityComment,
    ChangeUserKey,
    ChangeDate,
    ChangeProcedure,
    DocDetID
)
VALUES
(
    @DocumentKey,
    @SiteCode,
    @DocClientKey,
    0,                         -- Deleted
    1,                         -- DocStatus
    @CategoryKey,
    NULL,                      -- SubcategoryID
    @DocDesc,
    0,                         -- DocPriority
    NULL,                      -- DocPriorityComment
    @ChangeUserKey,
    @Now,
    @ChangeProcedure,
    @DocDetID
);

-- 4) Insert into tbl_IMG_DocumentData
INSERT INTO dbo.tbl_IMG_DocumentData
(
    DocumentKey,
    FieldData
)
VALUES
(
    @DocumentKey,
    @FieldData
);";

            // Parameters – reuse pattern from your sample inserts
            cmd.Parameters.AddWithValue("@DocType", "PDF");
            cmd.Parameters.AddWithValue("@UploadDate", DateTime.Now);
            cmd.Parameters.AddWithValue("@UploadUserKey", UploadUserKey);
            cmd.Parameters.AddWithValue("@UploadSource", "DOCUPLOAD");
            cmd.Parameters.AddWithValue("@DocStoreFileID", DocStoreFileId);

            cmd.Parameters.AddWithValue("@DocumentKey", Guid.NewGuid());
            cmd.Parameters.AddWithValue("@SiteCode", _siteCode);
            cmd.Parameters.AddWithValue("@DocClientKey", DocClientKey);
            cmd.Parameters.AddWithValue("@CategoryKey", CategoryKey);
            cmd.Parameters.AddWithValue("@ChangeUserKey", ChangeUserKey);

            cmd.Parameters.AddWithValue("@ChangeProcedure", "Test Data Load");
            cmd.Parameters.AddWithValue("@DocDesc", $"Test Document #{index:000000}");

            var fieldData = BuildFieldDataXml(index);
            cmd.Parameters.Add("@FieldData", SqlDbType.Xml).Value = fieldData;

            await cmd.ExecuteNonQueryAsync();
        }

        /// <summary>
        /// Builds synthetic FieldData XML.
        /// Every 10th record uses &lt;FieldData /&gt; to test the empty case.
        /// </summary>
        private string BuildFieldDataXml(int index)
        {
            // Test empty-case handling
            if (index % 10 == 0)
            {
                return "<FieldData />";
            }

            // Example XML using your “Fields” screenshot
            var title = (index % 2 == 0) ? "Mr" : "Ms";
            var firstName = $"First{index:000000}";
            var middleName = "M";
            var lastName = $"Last{index:000000}";
            var emailPromotion = (index % 3 == 0) ? "Y" : "N";
            var dob = new DateTime(1980, 1, 1).AddDays(index % 10_000);
            var age = (int)((DateTime.Today - dob).TotalDays / 365.25);
            var balance = Math.Round(_random.NextDouble() * 10_000, 2);

            var sb = new StringBuilder();
            sb.AppendLine("<FieldData>");
            sb.AppendLine($"  <Title>{title}</Title>");
            sb.AppendLine($"  <FirstName>{firstName}</FirstName>");
            sb.AppendLine($"  <MiddleName>{middleName}</MiddleName>");
            sb.AppendLine($"  <LastName>{lastName}</LastName>");
            sb.AppendLine($"  <EmailPromotion>{emailPromotion}</EmailPromotion>");
            sb.AppendLine($"  <DateOfBirth>{dob:yyyy-MM-dd}</DateOfBirth>");
            sb.AppendLine($"  <PersonAge>{age}</PersonAge>");
            sb.AppendLine($"  <Balance>{balance}</Balance>");
            sb.AppendLine("</FieldData>");

            return sb.ToString();
        }
    }
}


---

How this respects your schema

tbl_IMG_Documents

DocumentID is identity → we let SQL generate it and capture via SCOPE_IDENTITY().


tbl_IMG_DocumentDetails

DocDetID identity, FK to Documents.DocumentID → we insert with DocumentID=@DocumentID, capture DocDetID via SCOPE_IDENTITY().


tbl_IMG_DocumentKeys

Has FK to DocumentDetails.DocDetID → we pass @DocDetID.

DocumentKey is NEWID() → we generate new GUID per record.


tbl_IMG_DocumentData

PK/FK DocumentKey → we reuse the same @DocumentKey.

FieldData is xml NOT NULL → we always pass either <FieldData /> or a full <FieldData>…</FieldData>.



Every insert chain for one document is done in one batch on one connection, so FKs are always satisfied.


---

Tuning options

If 1,000,000 row insert is too slow, you can:

Run in parallel (multiple tasks, each with its own connection).

Or later we can convert to SqlBulkCopy using precomputed DocumentID/DocDetID with IDENTITY_INSERT ON for max speed.



But for a one-time big load, this version is simple, safe, and respects all relationships.


---

If you’d like the parallelized version (say 8 workers each loading a slice of the range), I can add that next.